<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <head>
        <title th:text="${user.username}">username</title>
        <script th:src="@{/js/jquery-3.6.0.js}"></script>
        <script th:src="@{/js/profile.js}" ></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"/>
        <link rel="stylesheet" th:href="@{/css/profile.css}"/>
    </head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <img class=" text-light logo_imei" height="55" width="55" src="/img/content/logo_isu.png"/>
            <div class="collapse container-fluid navbar-collapse" id="navbarText">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item border-bottom offset-md-1">
                        <a class="nav-link" th:href="@{/}">Главное</a>
                    </li>
                    <li class="nav-item border-bottom offset-md-1">
                        <a class="nav-link" th:href="@{/contests}">Конференции</a>
                    </li>
                    <li class="nav-item border-bottom offset-md-1">
                        <a class="nav-link" th:href="@{/api/info}">API</a>
                    </li>
                </ul>
                <div class="navbar-light container-sm  ml-auto row">
                    <a sec:authorize="!isAuthenticated()" class="nav-link" th:href="@{/login}">Войти</a>
                    <div id="user" class="col"  sec:authorize="hasRole('USER')"> 
                        <div class="row">
                            <a th:href="@{${'/profile/' +#authentication.principal.username }}">
                                <img class="object-fit-contain border-black rounded-circle" th:if="${#authentication.principal.profileImg}" width="38px" height="38px" id="profileImgIcon" th:src="@{${'/img/profiles/' + #authentication.principal.profileImg}}"/>
                            </a>
                            <form method="POST" th:action="@{/logout}"> <input type="submit"  class="btn btn-link" value="Выйти"/></form>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        <div id="userBox" >
            <div class="container">
            <ul class="list-inline">
                <li class="list-inline-item"><a th:href="@{${'/profile/' + user.username}}" th:text="${user.username}"></a></li>
                <li class="list-inline-item"><a th:href="@{${'/teams/with/' + user.username}}" th:text="Команды"></a></li>
                <li th:if="${loged}" class="list-inline-item"><a th:href="@{${'/profile/' + user.username}}" th:text="Настройки"></a></li>
            </ul> 
            </div>   
            <div id="TeamsData" class="container align-items-center justify-content-center border border-black" th:object="${user}">
                <div th:if="${loged}" class="row col">
                <a th:href="@{/teams/new}">Создать команду</a>
                </div>
                <div class="row col-auto">
                <table class="">
                    <tr class="row  align-items-center border border-black"><td class="col">Название команды</td><td class="col">Активный состав</td><td class="col" th:if="${loged}">Неактивный состав</td></tr>
                    <tr th:each="team : ${teamsList}" class="row border border-black  align-items-center">
                        <td class="col"><a th:text="${team.name}" th:href="@{${'/teams/edit/' + team.id }}" /></td>
                        <td class="col ">
                            <div th:each="teammate : ${team.userInTeam}" > 
                                <div th:if="${teammate.isActive}" class="align-items-center justify-content-center row">
                                    <div th:if="${teammate.user.profileImg}" class="col"><img  id="Teammateimg" class="img-thumbnail" th:src="@{${'/img/profiles/' + teammate.user.profileImg}}"/></div>
                                <div th:unless="${teammate.user.profileImg}" class="col"><img id="Teammateimg"  class="img-thumbnail" th:src="@{/img/profiles/unnamed.jpg}" /></div>
                                <div class="col"><a th:href="@{${'/profile/' + teammate.user.username }}" th:text="${teammate.user.username}"/></div>
                                </div>
                            </div>
                        </td>
                        <td th:if="${loged}" class="col">
                            <div th:each="teammate : ${team.userInTeam}" > 
                                <div th:unless="${teammate.isActive}" class="align-items-center justify-content-center row">
                                <div th:if="${teammate.user.profileImg}"><img  id="Teammateimg"  class="img-thumbnail" th:src="@{${'/img/profiles/' + teammate.user.profileImg}}"/></div>
                                <div th:unless="${teammate.user.profileImg}"><img id="Teammateimg"  class="img-thumbnail" th:src="@{/img/profiles/unnamed.jpg}" /></div>
                                <div><a th:href="@{${'/profile/' + teammate.user.username }}" th:text="${teammate.user.username}" class=""/></div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </table>
                </div>
            </div>
        </div>
    </body>
</html>
